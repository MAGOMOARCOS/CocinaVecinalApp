      - name: Create agent branch + push (unique)
        shell: bash
        run: |
          set -euo pipefail

          BRANCH="agent/codex-${{ github.run_id }}-${{ github.run_attempt }}"
          echo "BRANCH=$BRANCH" >> "$GITHUB_ENV"

          git config user.name "repo-agent"
          git config user.email "repo-agent@users.noreply.github.com"

          # crea rama nueva SIEMPRE (única por run+attempt)
          git checkout -b "$BRANCH"

          # commit solo si hay cambios
          if git diff --quiet; then
            echo "No changes to commit."
            exit 0
          fi

          git add -A
          git commit -m "fix: autofix build via agent"

          # push seguro (si por cualquier razón existe, crea otra rama aún más única)
          if ! git push -u origin "$BRANCH"; then
            BRANCH="agent/codex-${{ github.run_id }}-${{ github.run_attempt }}-${{ github.sha }}"
            echo "BRANCH=$BRANCH" >> "$GITHUB_ENV"
            git checkout -b "$BRANCH"
            git push -u origin "$BRANCH"
          fi
